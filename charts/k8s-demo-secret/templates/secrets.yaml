# Secret 1: Database credentials (Opaque)
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name }}-db-credentials
type: Opaque
stringData:
  DB_USERNAME: {{ .Values.dbCredentials.username | quote }}
  DB_PASSWORD: {{ .Values.dbCredentials.password | quote }}
  DB_HOST: {{ .Values.dbCredentials.host | quote }}
  DB_PORT: {{ .Values.dbCredentials.port | quote }}
  DB_NAME: {{ .Values.dbCredentials.database | quote }}
  # Connection string assembled from individual values
  DATABASE_URL: "postgresql://{{ .Values.dbCredentials.username }}:{{ .Values.dbCredentials.password }}@{{ .Values.dbCredentials.host }}:{{ .Values.dbCredentials.port }}/{{ .Values.dbCredentials.database }}"

# Secret 2: API Keys
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name }}-api-keys
type: Opaque
stringData:
  STRIPE_API_KEY: {{ .Values.apiKeys.stripe | quote }}
  SENDGRID_API_KEY: {{ .Values.apiKeys.sendgrid | quote }}

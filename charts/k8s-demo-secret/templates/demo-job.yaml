# Demo pod that shows secrets as env vars and mounted files
apiVersion: batch/v1
kind: Job
metadata:
  name: {{ .Release.Name }}-secret-demo
spec:
  backoffLimit: 1
  template:
    spec:
      restartPolicy: Never
      containers:
        - name: secret-reader
          image: {{ .Values.image.repository }}:{{ .Values.image.tag }}
          command:
            - /bin/sh
            - -c
            - |
              echo "===== Secrets as Environment Variables ====="
              echo "DB_HOST=$DB_HOST"
              echo "DB_PORT=$DB_PORT"
              echo "DB_NAME=$DB_NAME"
              echo "DB_USERNAME=$DB_USERNAME"
              echo "(DB_PASSWORD is set but hidden)"
              echo ""
              echo "===== Secrets as Mounted Files ====="
              echo "Files in /etc/secrets/api-keys/:"
              ls -la /etc/secrets/api-keys/
              echo ""
              echo "===== Demo Complete ====="
              echo "Check pod logs to see the output"
          # Method 1: Secrets as environment variables
          envFrom:
            - secretRef:
                name: {{ .Release.Name }}-db-credentials
          # Method 2: Specific secret key as env var
          env:
            - name: STRIPE_KEY
              valueFrom:
                secretKeyRef:
                  name: {{ .Release.Name }}-api-keys
                  key: STRIPE_API_KEY
          volumeMounts:
            # Method 3: Secrets as mounted files
            - name: api-keys-volume
              mountPath: /etc/secrets/api-keys
              readOnly: true
      volumes:
        - name: api-keys-volume
          secret:
            secretName: {{ .Release.Name }}-api-keys

apiVersion: deployments.plural.sh/v1alpha1
kind: ServiceDeployment
metadata:
  name: k8s-demo-networkpolicy
spec:
  namespace: demo-prod
  cluster: k8calab2
  git:
    url: https://github.com/kandula1/helm-charts.git
    ref: main
    folder: charts/k8s-demo-networkpolicy
  helm:
    values:
      targetApp: demo-app
      ingressRules:
        - fromNamespace: demo-staging
          port: 80
        - fromNamespace: default
          port: 80
          # Pods in demo-staging can reach demo-prod pods on port 80 ✅
          # Pods in default namespace can reach demo-prod pods on port 80 ✅
          # Pods in test-ns-1, test-ns-2, test-ns-3, or any other namespace → BLOCKED ❌
        
      egressRules:
        - toPort: 53
          protocol: UDP
          toCIDR: 10.0.0.0/8
        - toPort: 80
          protocol: TCP
          toCIDR: 0.0.0.0/0
          # Demo-prod pods can do DNS lookups (port 53 UDP) within the internal network ✅
          # Demo-prod pods can reach any HTTP endpoint OR external IP (port 80 TCP) anywhere ✅
          # Demo-prod pods trying to reach port 443, 8080, or anything else → BLOCKED ❌